<!DOCTYPE html>
<html>
<head>
<!-- Load the Paper.js library -->
<meta charset="UTF-8" />
<script type="text/javascript" src="javascript/paper-full.min.js"></script>
<!-- Define inlined PaperScript associate it with myCanvas -->
<script type="text/javascript">
window.onload = function() {

var canvas = document.getElementById('myCanvas')
paper.setup(canvas)

var text = new paper.PointText({
    point: [50,50],
    content: 'Waiting for server...',
    fillColor: 'black',
    fontFamily: 'Courier New',
    fontWeight: 'bold',
    fontSize: 15
})

function renderPoints (points) {
    console.dir(points)
    var temp
    points['MAIN'].forEach(function(p) {
        temp = new paper.Path.Circle(p['x']*50 + 800, p['y']*50 + 100, 5)
        temp.fillColor = 'black'
    })
} 

function renderObjects (data) {
    console.dir(data)
    var lst = data['data']
    lst.forEach(function(object) {
        var name = object['name']
        var type = object['type']
        var x = object['x']
        var y = object['y']
        var temp = new paper.Path.Circle(x*50 + 800, y*50 + 100, 5)
        if(type == "ROBOT") {
            temp.strokeColor = 'red'
            temp.strokeWidth = 4
        } else if(type == "APPLE") {
            temp.fillColor = 'green'
        } else {
            temp.fillColor = 'yellow'
        }
        console.log("updated location for " + 
            name + " type: " + type + " new location: (" + x + "," + y + ")")
    })
} 

function renderEval (output) {
    console.log(output)
    text.content = output
}

function updateObjects() {
    var xhr = new XMLHttpRequest()
    var contentType= "text/json; charset=UTF-8"
    xhr.open("GET", "/objects", true)
    xhr.setRequestHeader("Content-type", contentType)
    xhr.onload = function () {
    var data = JSON.parse(this.responseText)
        renderObjects(data)
    }
    xhr.send()
}



var xhr = new XMLHttpRequest()
var contentType= "text/json; charset=UTF-8"
xhr.open("GET", "/gridworld-points", true)
xhr.setRequestHeader("Content-type", contentType)
xhr.onload = function () {
    var data = JSON.parse(this.responseText)
    renderPoints(data)
}
xhr.send()

updateObjects()



button = document.getElementById("button")

button.onclick = function (event) {
    textVal = document.getElementById("val").value
    console.log("text: " + textVal)
    var xhr = new XMLHttpRequest()
    var contentType= "application/x-www-form-urlencoded; charset=UTF-8"
    var params = "command=" + textVal

    xhr.open("POST", "/eval", true)
    xhr.setRequestHeader("Content-type", contentType)
    xhr.onload = function () {
        renderEval(this.responseText)
        updateObjects()
    }

    xhr.send(params)
}

    paper.view.draw()
}

</script>
</head>
<body>
	<canvas id="myCanvas" resize="true"></canvas>
        Enter text: <input type="text" name="command" id="val">
        <button id="button" type="button"> Submit </button>
<style type="text/css">
html,
body {
    margin: 0;
    overflow: hidden;
    height: 100%;
}

/* Scale canvas with resize attribute to full size */
canvas[resize] {
    width: 100%;
    height: 75%;
}
</style>
</body>
</html>
